<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —á–∏—Å—Ç–æ—Ç—ã JARVIS —á–∞—Ç–∞</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .testing { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    </style>
</head>
<body>
    <h1>üßπ –ü—Ä–æ–≤–µ—Ä–∫–∞ JARVIS –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∂–∞—Ç—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤</h1>
    
    <button onclick="testChatGreeting()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —á–∞—Ç–∞</button>
    <button onclick="testChatAPI()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å API —á–∞—Ç–∞</button>
    
    <div id="results"></div>

    <script>
        function addResult(message, type) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.innerHTML = message;
            resultsDiv.appendChild(resultDiv);
        }

        function testChatGreeting() {
            addResult('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ JARVIS...', 'testing');
            
            // –ò–º–∏—Ç–∏—Ä—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
            const expectedGreeting = '–ü—Ä–∏–≤–µ—Ç! –Ø –î–ñ–ê–†–í–ò–° - –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –Ω–∞—à–µ–≥–æ —Å–∞–π—Ç–∞! üòä\n\n–ü–æ–º–æ–≥—É –≤—ã–±—Ä–∞—Ç—å —É—Å–ª—É–≥–∏, —Ä–∞—Å—Å–∫–∞–∂—É –æ —Ç–∞—Ä–∏—Ñ–∞—Ö –∏ –æ—Ç–≤–µ—á—É –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã\n\n–ß–µ–º –º–æ–≥—É –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω?';
            
            if (expectedGreeting.includes('ÔøΩÔøΩ')) {
                addResult('‚ùå <strong>–ù–∞–π–¥–µ–Ω—ã —Å–∂–∞—Ç—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–∏!</strong>', 'error');
            } else {
                addResult('‚úÖ <strong>–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —á–∏—Å—Ç–æ–µ!</strong><br>–í—Å–µ —Å–∏–º–≤–æ–ª—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.', 'success');
            }
        }

        async function testChatAPI() {
            addResult('üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º API —á–∞—Ç–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–∂–∞—Ç—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤...', 'testing');
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        messages: [
                            { role: 'user', content: '–ø—Ä–∏–≤–µ—Ç' }
                        ]
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    const responseText = data.message || '';
                    
                    if (responseText.includes('ÔøΩÔøΩ')) {
                        addResult(`‚ùå <strong>–ù–∞–π–¥–µ–Ω—ã —Å–∂–∞—Ç—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ –æ—Ç–≤–µ—Ç–µ API!</strong><br>–û—Ç–≤–µ—Ç: ${responseText.substring(0, 100)}...`, 'error');
                    } else {
                        addResult(`‚úÖ <strong>API –æ—Ç–≤–µ—á–∞–µ—Ç —á–∏—Å—Ç–æ!</strong><br>–û—Ç–≤–µ—Ç: ${responseText.substring(0, 100)}...`, 'success');
                    }
                } else {
                    addResult(`‚ö†Ô∏è <strong>–û—à–∏–±–∫–∞ API:</strong> ${response.status}`, 'error');
                }
            } catch (error) {
                addResult(`‚ùå <strong>–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:</strong><br>${error.message}`, 'error');
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            setTimeout(testChatGreeting, 500);
        };
    </script>
</body>
</html>
